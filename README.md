# svc-keys

`svc-keys` — это легковесный внутренний сервис для выдачи и проверки временных токенов между сервисами внутри сети.  

Он позволяет централизованно управлять токенами, выдавать сервисам права доступа к другим сервисам и проверять валидность токенов в реальном времени.

---

## Особенности

- Генерация временных токенов с TTL.
- Валидация токенов для конкретного сервиса.
- Простая конфигурация прав доступа через встроенный JSON (`permissions.json`).
- Хранение токенов в памяти.

---

## Установка

### 1. Клонируйте репозиторий

```bash
git clone git@github.com:FreedomDevs/svc-keys.git
cd svc-keys
```

### 2. Запуск сервиса

```bash
cargo run
```

### 3. Сборка в Docker

```bash
docker build . -t svc-keys:latest
```

---

## Эндпоинты

Все эндпоинты имеют префикс `/keys`.

### 1. `POST /keys/token` — выдача токена

**Описание:** Генерация временного токена для другого сервиса.

**Запрос (JSON):**

```json
{
  "issuer": "bans",
  "audience": "users",
  "ttl_sec": 60
}
```

- `issuer` — имя сервиса, который запрашивает токен.
- `audience` — имя сервиса, которому нужен токен.
- `ttl_sec` — срок жизни токена в секундах.

**Ответ (JSON):**

```json
{
  "token": "base64-token-string",
  "exp": 1734567890
}
```

---

### 2. `POST /keys/validate` — проверка токена

**Описание:** Проверка валидности токена для конкретного сервиса.

**Запрос (JSON):**

```json
{
  "token": "base64-token-string",
  "self_name": "users"
}
```

**Ответ (JSON):**

```json
{
  "active": true
}
```

- `active: true` — токен действителен.
- `active: false` — токен недействителен, истёк или предназначен для другого сервиса.

---

## Настройка прав доступа

Права доступа хранятся в файле `permissions.json`:

```json
{
  "bans": ["users"],
  "users": ["users"],
  "auth": ["auth", "users"]
}
```

- Ключ — имя сервиса, который может выдавать токены.
- Значение — список сервисов, для которых можно выдавать токены.

---

## Лицензия

GPL-3.0

